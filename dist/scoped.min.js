/*!
betajs-scoped - v0.0.1 - 2015-02-13
Copyright (c) Oliver Friedmann
MIT Software License.
*/
var Scoped=function(){function a(a){function b(a){return d.extend({route:null,parent:null,children:{},watchers:[],data:{},ready:!1},a)}function c(a){if(!a.ready){if(a.parent&&!a.parent.ready)return void c(a.parent);if(a.route in a.parent.data){a.data=a.parent.data[a.route],a.ready=!0;for(var b=0;b<a.watchers.length;++b)a.watchers[b].callback.call(a.watchers[b].context||this,a.data);a.watchers=[];for(var d in a.children)c(a.children[d])}}}function e(b){if(!b.ready){b.parent&&!b.parent.ready&&e(b.parent),b.ready=!0,a.tree&&"object"==typeof b.parent.data&&(b.parent.data[b.route]=b.data);for(var c=0;c<b.watchers.length;++c)b.watchers[c].callback.call(b.watchers[c].context||this,b.data);b.watchers=[]}}function f(a,b){if("object"==typeof b)for(var d in b)a.data[d]=b[d],a.children[d]&&(a.children[d].data=b[d]);else a.data=b;e(a);for(var f in a.children)c(a.children[f])}function g(a){if(a.ready&&a.data)for(var b in a.data)delete a.data[b]}function h(a){if(!a)return j;for(var d=a.split("."),e=j,f=0;f<d.length;++f)d[f]in e.children?e=e.children[d[f]]:(e.children[d[f]]=b({parent:e,route:d[f]}),e=e.children[d[f]],c(e));return e}function i(a,b,c){a.ready?b.call(c||this,a.data):a.watchers.push({callback:b,context:c})}a=d.extend({tree:!1,global:!1,root:{}},a);var j=b({ready:!0}),k=null;if(a.tree){if(a.global){try{window&&(k=window)}catch(l){}try{global&&(k=global)}catch(l){}}else k=a.root;j.data=k}return{extend:function(a,b){f(h(a),b)},set:function(a,b){var c=h(a);c.data&&g(c),f(c,b)},digest:function(a){c(h(a))},obtain:function(a,b,c){i(h(a),b,c)}}}function b(c,e,f,g){var h=null,i=[],j=a({tree:!0}),k=a({tree:!1}),l={global:{namespace:g},root:{namespace:f},local:{namespace:j},"default":{namespace:k},parent:{namespace:e},scope:{namespace:j,readonly:!1}};return{nextScope:function(){return h||(h=b(this,j,f,g)),h},subScope:function(){var a=this.nextScope();return i.push(a),h=null,a},binding:function(b,c,e){if(!l[b]||!l[b].readonly){var f;f="string"!=d.typeOf(c)?{namespace:a({tree:!0,root:c}),path:null}:this.resolve(c),l[b]=d.extend(e,f)}return this},resolve:function(a){var b=a.split(":");if(1==b.length)return{namespace:k,path:b[0]};var c=l[b[0]];return{namespace:c.namespace,path:c.path&&b[1]?c.path+"."+b[1]:c.path||b[1]}},define:function(){var a=d.matchArgs(arguments,{namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),b=this.resolve(a.namespaceLocator);return this.require(a.dependencies,a.hiddenDependencies,function(){arguments[arguments.length-1].ns=b,b.namespace.set(b.path,a.callback.apply(a.context||this,arguments))},this),this},extend:function(){var a=d.matchArgs(arguments,{namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),b=this.resolve(a.namespaceLocator);return this.require(a.dependencies,a.hiddenDependencies,function(){arguments[arguments.length-1].ns=b,b.namespace.extend(b.path,a.callback.apply(a.context||this,arguments))},this),this},condition:function(){var a=d.matchArgs(arguments,{namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),b=this.resolve(a.namespaceLocator);return this.require(a.dependencies,a.hiddenDependencies,function(){arguments[arguments.length-1].ns=b;var c=a.callback.apply(a.context||this,arguments);c&&b.namespace.set(b.path,c)},this),this},require:function(){var a=d.matchArgs(arguments,{dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),b=a.dependencies||[],c=b.concat(a.hiddenDependencies||[]),e=c.length,f=[],g={};if(e)for(var h=0;h<c.length;++h){var i=this.resolve(c[h]);h<b.length&&f.push(null),i.namespace.obtain(i.path,function(b){this.i<f.length&&(f[this.i]=b),e--,0===e&&(f.push(g),a.callback.apply(a.context||this.ctx,f))},{ctx:this,i:h})}else f.push(g),a.callback.apply(a.context||this,f);return this},digest:function(a){var b=this.resolve(a);return b.namespace.digest(b.path),this}}}var c={get:function(a){try{if(window)return window[a]}catch(b){}try{if(global)return global[a]}catch(b){}return null},set:function(a,b){try{window&&(window[a]=b)}catch(c){}try{global&&(global[a]=b)}catch(c){}return b},setPath:function(a,b){var c=a.split(".");if(1==c.length)return this.set(a,b);for(var d=this.get(c[0])||this.set(c[0],{}),e=1;e<c.length-1;++e)c[e]in d||(d[c[e]]={}),d=d[c[e]];return d[c[c.length-1]]=b,b},getPath:function(a){var b=a.split(".");if(1==b.length)return this.get(a);for(var c=this.get(b[0]),d=1;d<b.length;++d){if(!c)return c;c=c[b[d]]}return c}},d={method:function(a,b){return function(){return b.apply(a,arguments)}},extend:function(a,b){a=a||{},b=b||{};for(var c in b)a[c]=b[c];return a},typeOf:function(a){return"[object Array]"===Object.prototype.toString.call(a)?"array":typeof a},matchArgs:function(a,b){var c=0,d={};for(var e in b)b[e]===!0||this.typeOf(a[c])==b[e]?(d[e]=a[c],c++):"undefined"==this.typeOf(a[c])&&c++;return d}},e={__namespace:"Scoped",attach:function(a){a&&(e.__namespace=a);var b=c.get(e.__namespace);return b==this?this:(e.__revert=b,c.set(a,this),this)},detach:function(a){return a&&c.set(e.__namespace,null),"undefined"!=typeof e.__revert&&c.set(e.__namespace,e.__revert),delete e.__revert,this},exports:function(a){return"undefined"!=typeof module&&"exports"in module&&(module.exports=a),this}},f=a({tree:!0,global:!0}),g=a({tree:!0}),h=b(null,g,g,f),i={attach:e.attach,detach:e.detach,exports:e.exports,nextScope:d.method(h,h.nextScope),subScope:d.method(h,h.nextScope),binding:d.method(h,h.binding),condition:d.method(h,h.condition),define:d.method(h,h.define),extend:d.method(h,h.extend),require:d.method(h,h.require),digest:d.method(h,h.digest),getGlobal:d.method(c,c.getPath),setGlobal:d.method(c,c.setPath)};return i.attach(),i.exports(i),i}.call(this);