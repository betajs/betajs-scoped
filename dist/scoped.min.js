/*!
betajs-scoped - v0.0.1 - 2014-12-13
Copyright (c) Oliver Friedmann
MIT Software License.
*/
var Scoped=function(){function e(e){function t(e){return a.extend({route:null,parent:null,children:{},watchers:[],data:{},ready:!1},e)}function n(e){if(!e.ready){if(e.parent&&!e.parent.ready)return n(e.parent),void 0;if(e.route in e.parent.data){e.data=e.parent.data[e.route],e.ready=!0;for(var t=0;e.watchers.length>t;++t)e.watchers[t].callback.call(e.watchers[t].context||this,e.data);e.watchers=[];for(var a in e.children)n(e.children[a])}}}function r(t){if(!t.ready){t.parent&&!t.parent.ready&&r(t.parent),t.ready=!0,e.tree&&"object"==typeof t.parent.data&&(t.parent.data[t.route]=t.data);for(var n=0;t.watchers.length>n;++n)t.watchers[n].callback.call(t.watchers[n].context||this,t.data);t.watchers=[]}}function c(e,t){if("object"==typeof t)for(var a in t)e.data[a]=t[a],e.children[a]&&(e.children[a].data=t[a]);else e.data=t;r(e);for(var c in e.children)n(e.children[c])}function i(e){if(e.ready&&e.data)for(var t in e.data)delete e.data[t]}function o(e){if(!e)return d;for(var a=e.split("."),r=d,c=0;a.length>c;++c)a[c]in r.children?r=r.children[a[c]]:(r.children[a[c]]=t({parent:r,route:a[c]}),r=r.children[a[c]],n(r));return r}function s(e,t,n){e.ready?t.call(n||this,e.data):e.watchers.push({callback:t,context:n})}e=a.extend({tree:!1,global:!1},e);var d=t({ready:!0}),l=null;if(e.tree){if(e.global){try{window&&(l=window)}catch(h){}try{global&&(l=global)}catch(h){}}else l={};d.data=l}return{extend:function(e,t){c(o(e),t)},set:function(e,t){var n=o(e);n.data&&i(n),c(n,t)},digest:function(e){n(o(e))},obtain:function(e,t,n){s(o(e),t,n)}}}function t(n,r,c,i){var o=null,s=[],d=e({tree:!0}),l=e({tree:!1}),h={global:{namespace:i},root:{namespace:c},local:{namespace:d},"default":{namespace:l},parent:{namespace:r},scope:{namespace:d,readonly:!1}};return{nextScope:function(){return o||(o=t(this,d,c,i)),o},subScope:function(){var e=this.nextScope();return s.push(e),o=null,e},binding:function(e,t,n){return h[e]&&h[e].readonly||(h[e]=a.extend(n,this.resolve(t))),this},resolve:function(e){var t=e.split(":");if(1==t.length)return{namespace:l,path:t[0]};var n=h[t[0]];return{namespace:n.namespace,path:n.path&&t[1]?n.path+"."+t[1]:n.path||t[1]}},define:function(){var e=a.matchArgs(arguments,{namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),t=this.resolve(e.namespaceLocator);return this.require(e.dependencies,e.hiddenDependencies,function(){t.namespace.set(t.path,e.callback.apply(e.context||this,arguments))},this),this},extend:function(){var e=a.matchArgs(arguments,{namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),t=this.resolve(e.namespaceLocator);return this.require(e.dependencies,e.hiddenDependencies,function(){t.namespace.extend(t.path,e.callback.apply(e.context||this,arguments))},this),this},condition:function(){var e=a.matchArgs(arguments,{namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),t=this.resolve(e.namespaceLocator);return this.require(e.dependencies,e.hiddenDependencies,function(){var n=e.callback.apply(e.context||this,arguments);n&&t.namespace.set(t.path,n)},this),this},require:function(){var e=a.matchArgs(arguments,{dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),t=e.dependencies||[],n=t.concat(e.hiddenDependencies||[]),r=n.length,c=[];if(r)for(var i=0;n.length>i;++i){var o=this.resolve(n[i]);t.length>i&&c.push(null),o.namespace.obtain(o.path,function(t){this.i<c.length&&(c[this.i]=t),r--,0===r&&e.callback.apply(e.context||this.ctx,c)},{ctx:this,i:i})}else e.callback.apply(e.context||this,c);return this},digest:function(e){var t=this.resolve(e);return t.namespace.digest(t.path),this}}}var n={get:function(e){try{if(window)return window[e]}catch(t){}try{if(global)return global[e]}catch(t){}return null},set:function(e,t){try{window&&(window[e]=t)}catch(n){}try{global&&(global[e]=t)}catch(n){}}},a={method:function(e,t){return function(){t.apply(e,arguments)}},extend:function(e,t){e=e||{},t=t||{};for(var n in t)e[n]=t[n];return e},typeOf:function(e){return"[object Array]"===Object.prototype.toString.call(e)?"array":typeof e},matchArgs:function(e,t){var n=0,a={};for(var r in t)t[r]===!0||this.typeOf(e[n])==t[r]?(a[r]=e[n],n++):"undefined"==this.typeOf(e[n])&&n++;return a}},r={__namespace:"Scoped",attach:function(e){e&&(r.__namespace=e);var t=n.get(r.__namespace);return t==this?this:(r.__revert=t,n.set(e,this),this)},detach:function(e){return e&&n.set(r.__namespace,null),r.__revert!==void 0&&n.set(r.__namespace,r.__revert),delete r.__revert,this},exports:function(e){return"undefined"!=typeof module&&"exports"in module&&(module.exports=e),this}},c=e({tree:!0,global:!0}),i=e({tree:!0}),o=t(null,i,i,c),s={attach:r.attach,detach:r.detach,exports:r.exports,nextScope:a.method(o,o.nextScope),subScope:a.method(o,o.nextScope),binding:a.method(o,o.binding),condition:a.method(o,o.condition),define:a.method(o,o.define),extend:a.method(o,o.extend),require:a.method(o,o.require),digest:a.method(o,o.digest)};return s.attach(),s.exports(s),s}.call(this);